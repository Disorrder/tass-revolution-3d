extends ../../../index.pug

mixin house(color)
    a-entity.house&attributes(attributes)
        a-box(position="0 0.5 0")
        a-cylinder(position="0 1.14 0" rotation="-90 0 0" scale="1 1 0.5" radius="0.6" segments-radial="3")

block scene
    a-assets
        //- img#skyTexture(crossorigin src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg")
        //- img#skyTexture(crossorigin src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg")
        img#groundTexture(crossorigin src="https://cdn.aframe.io/a-painter/images/floor.jpg")
            
        img#tex-bg-forest(src="/assets/textures/forest3.png")
        img#tex-bg-piter(src="/assets/textures/piter2.png")
        img#tex-photo-1(src="/assets/photos/scene1/date.png")
        img#tex-photo-2(src="/assets/photos/scene1/header.png")
        img#tex-photo-3(src="/assets/photos/scene1/war_title1.png")
        img#tex-photo-4(src="/assets/photos/scene1/war_title2.png")
        img#tex-photo-5(src="/assets/photos/scene1/bread_troubles.png")
        img#tex-photo-6(src="/assets/photos/scene1/bread_people.jpg")
        img#tex-photo-7(src="/assets/photos/scene1/Nikolay.jpg")
        img#tex-photo-8(src="/assets/photos/scene1/Nikolay_bread_face.png")
        img#tex-particle-1(src="/assets/textures/explosion_map.png")

        audio#audio-bg-1(src="/assets/audio/scene1/background1.wav")
        audio#audio-sfx-1(src="/assets/audio/scene1/train1.wav")
        audio#audio-sfx-2(src="/assets/audio/scene1/img_appear-1.wav")
        audio#audio-sfx-3(src="/assets/audio/scene1/img_appear-2.wav")
        audio#audio-sfx-4(src="/assets/audio/scene1/nikolay_deleted.wav")
            
        video#video-fire(src="/assets/video/fire3.mp4" _autoplay loop="true")
        
        //- mixins
        a-mixin#debug(material="visible: true; wireframe: true; color: red; shader: flat; opacity: 0.4")
        a-mixin#debug-ray(geometry="primitive: box; width: 0.1; depth: 2000;" material="shader: flat; color: yellow; opacity: 0.5")
            
        a-mixin#halfSphere(geometry="primitive: sphere; radius: 15; thetaLength: 90;")
        a-mixin#sphere(geometry="primitive: sphere; radius: 15;")

        a-mixin#trigger(material="visible: false;" trigger="")
        a-mixin#trigger-particles(particle-system="preset: snow; particleCount: 100; maxAge: 2; opacity: 1; type: 3; size: 1; color: red,orange; positionSpread: 7 0 7; velocityValue: 0 -2 0; velocitySpread: 2 1 0;")

        a-mixin#black(material="shader: flat; color: #000;")
        a-mixin#grey(material="color: #aaa; roughness: 1;")


    a-sky(color="#000")

    a-light.sky_light(type="ambient" color="#fff" intensity="0")
    a-light.sky_light(type="point" position="0 4 0" color="#fff" intensity="0")

    //- global objects
    a-entity#player(position="0 2 0" rotation="0 20 0")
        a-sound#bg_sound(src="#audio-bg-1" volume="1" autoplay="true" loop="true")
        a-camera(_wasd-controls="acceleration: 16500;" fov="60")
            a-entity(position="0 0 -2")
                a-cursor(material="color: #eee; opacity: 0.8" fuse="true" fuse-timeout="1500" raycaster="objects: .interactive" cursor-events)
                    a-animation(begin="fusing" end="mouseleave" attribute="scale" to="2 2 2" dur="1500" easing="ease-in")
                    a-animation(begin="fusing" end="mouseleave" attribute="geometry.thetaLength" from="360" to="0" dur="1500" easing="ease-in")

                    a-animation(begin="mouseleave" attribute="scale" to="1 1 1" dur="100" easing="ease")
                    a-animation(begin="mouseleave" attribute="geometry.thetaLength" to="360" dur="500" easing="ease")

                    a-animation(begin="click" attribute="scale" from="0 0 0" to="1 1 1" _delay="100" dur="300" easing="ease")
                    a-animation(begin="click" attribute="geometry.thetaLength" to="360" dur="100" easing="ease")

    //- scene fragments
    a-entity#world
        a-entity#backlight(position="0 0 0")
            a-path#bg-fire-path(position="0 100 0" line-geometry="" visible="false")
                a-entity.a-path-point(position="-360 0 -1050" geometry="primitive: box;")
                a-entity.a-path-point(position="-132 0 -1064" geometry="primitive: box;")
                a-entity.a-path-point(position="603 0 -946" geometry="primitive: box;")
                a-entity.a-path-point(position="1128 0 -45" geometry="primitive: box;")
                a-entity.a-path-point(position="892 0 650" geometry="primitive: box;")

            //- a-entity#pf(position="0 5 -10" particle-fire="path: #bg-fire-path;")
            //- a-box(position="0 4 -10")

            a-entity.pivot(rotation="0 0 0")
                //- a-plane.interactive(_position="0 3 -4" width="0" height="0" shader="video" src="#video-fire" transparent="true")
                //- a-video.interactive(position="0 30 -1050" width="900" height="450" src="#video-fire" transparent="true")
                a-entity
                    a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 50; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.2; size: 1000,500,1; color: red,orange,black; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
            
            a-entity.pivot(rotation="0 -45 0")
                //- a-video.interactive(position="0 100 -1050" width="1024" height="512" src="#video-fire" transparent="true")
                a-entity
                    a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 150; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.2; size: 1000,500,1; color: red,orange,black; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
                    //- a-entity.particle-fire.big(position="0 0.11 -1080" particle-system="particleCount: 5; maxAge: 1.5; positionSpread: 1500 50 1; randomize: true; opacity: 0.3; size: 5000; color: red,black; accelerationValue: null; accelerationSpread: null; velocityValue: null; velocitySpread: null; texture: #tex-particle-1;")
                    //- a-entity.particle-fire.small(position="-350 0.11 -1010" particle-system="particleCount: 30; maxAge: 0.5; positionSpread: 1100 50 1; randomize: true; opacity: 0.1; size: 1500; color: orange; accelerationValue: null; accelerationSpread: null; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
            
            a-entity.pivot(rotation="0 -90 0")
                //- a-video.interactive(position="0 70 -1050" width="1024" height="512" src="#video-fire" transparent="true")
                a-entity
                    //- a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 80; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.1; size: 1000; color: red,orange; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
                    a-entity.particle-fire.small(position="200 -10.11 -1010" particle-system="particleCount: 10; maxAge: 8; positionSpread: 1100 50 1; randomize: true; opacity: 0.8; size: 1500,1,1,1; color: orange,black,black,black; accelerationValue: null; accelerationSpread: null; velocityValue: 200 50 0; velocitySpread: null; texture: #tex-particle-1;")

            //- Horizon textures
            //- a-plane.interactive(position="0 3 -4" shader="video" src="#video-fire" transparent="true")
            //- a-video.interactive(position="0 3 -4" src="#video-fire" transparent="true")
            a-cylinder.background(position="0 50 0" geometry="height: 200; radius: 1000; segmentsHeight: 1; thetaStart: 55; thetaLength: 145; openEnded: true;" src="#tex-bg-forest" repeat="2.5 0.9" shader="flat" transparent="true" side="back" color="#000")
            a-cylinder.background(position="0 -50 0" geometry="height: 100; radius: 1000; segmentsHeight: 1; thetaStart: 55; thetaLength: 145; openEnded: true;" _shader="flat" color="#010" side="back")
            //- Horizon Piter
            a-cylinder.background(position="0 50 0" geometry="height: 200; radius: 1000; segmentsHeight: 1; thetaStart: 288; thetaLength: 45; openEnded: true;" src="#tex-bg-piter" repeat="1 0.9" shader="flat" transparent="true" side="back" color="#000")
            a-cylinder.background(position="0 50 0" geometry="height: 200; radius: 1100; segmentsHeight: 1; thetaStart: 288; thetaLength: 45; openEnded: true;" _src="#tex-bg-piter" _repeat="1 0.9" shader="flat" _transparent="true" side="back" color="#532")

        a-entity#group1(rotation="0 -40 0")            
            a-light(position="0 5 0" type="point" distance="9" intensity="1")
            a-box.platform(position="0 2 0" rotation="0 0 0" width="30" height="0.3" depth="10" _src="/assets/textures/wooden_floor.jpg" repeat="2 2" _color="#ccc" roughness="1")
            a-entity#trigger0(position="0 2 0")
                a-entity(mixin="sphere trigger" geometry="radius: 0.7;" material="opacity: 0.1;")
                //- a-entity(mixin="trigger-particles" _particle-system="size: 10; maxAge: 4; positionSpread: 25 0 25;")
            

        a-entity#group3(rotation="0 -20 0")
            a-entity(position="0 0 -200")
                a-entity#trigger1(position="-474 3 0" scale="3 3 3")
                    a-entity(mixin="sphere trigger")
                    a-entity(mixin="trigger-particles" particle-system="size: 10; maxAge: 4; positionSpread: 25 0 25;")

                a-entity.railway
                    a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    //- a-entity#flag_t1(position="-400 0 0" scale="1 10 1" mixin="halfSphere debug")
                    //- a-entity#flag_t2(position="450 0 0" scale="1 10 1" mixin="halfSphere debug")
                    a-entity#train1(position="-400 0 0" rotation="0 180 0" scale="2.2 2.2 2.2"
                        __material="shader: flat; color: #000;" __common-material
                        gen-train="wagonMap: head,passanger,passanger,passanger,generic,platform,platform,platform,tanker,tanker,tanker,tanker,passanger,passanger,passanger"
                        sound="src: #audio-sfx-1; volume: 90; loop: true; on: run;"
                    )
                        a-animation(begin="run" dur="11000" attribute="position" to="450 0 0" easing="linear")
                
                    a-box(position="-500 4 0" width="300" height="9" depth="20" mixin="black" color="#000")
                    a-box(position="290 4 0" width="300" height="9" depth="20" mixin="black" color="#000")
                    
        a-entity#group4(rotation="0 -160 0")
            a-entity(position="-50 0 -70")
                a-entity.railway
                    a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    a-entity#train2(position="-200 0 0" rotation="0 180 0" scale="2.2 2.2 2.2"
                        __material="shader: flat; color: #000;" __common-material
                        gen-train="wagonMap: head,passanger,passanger,passanger,generic,platform,platform,platform,tanker,tanker,tanker,tanker,passanger,passanger,passanger"
                    )
                        a-animation(begin="run" dur="5000" attribute="position" to="320 0 0" easing="ease-out-sine")
                
                    a-box(position="-300 4 0" width="300" height="9" depth="20" mixin="black" color="#000")
                    
                a-entity.houses
                    +house()(position="-40 0 -20" scale="5 5 5")
                    +house()(position="10 0 -40" scale="5 5 5")
                    +house()(position="25 0 -20" scale="5 5 5")
        
        a-entity#group5(rotation="0 -40 0")
            a-entity(position="-200 0 10")
                a-entity.railway
                    a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    a-entity#train3(position="-200 0 0" rotation="0 180 0" scale="4 4 4"
                        gen-train="wagonMap: head,passanger,passanger,generic,platform,platform,tanker,tanker,passanger,passanger,passanger"
                    )
                        a-animation(begin="run" _delay="2000" dur="7000" attribute="position" to="715 0 0" easing="ease-out-sine")
                
                    a-box(position="-300 4 0" width="300" height="9" depth="20" mixin="black" color="#000")
                    
        a-entity#group6(rotation="0 -220 0")
            a-entity(position="0 0 -400")
                a-entity#trigger2(position="0 3 0" scale="10 5 10")
                    a-entity(mixin="sphere trigger debug" geometry="radius: 15;")
                    //- a-entity(mixin="trigger-particles" particle-system="size: 10; particleCount: 200; maxAge: 4; positionSpread: 25 0 25;")

        a-entity.radial#images
            a-entity.pivot(rotation="0 50 0")
                a-image#img1(position="0 12 -16" width="12" image-init="" src="#tex-photo-1" opacity="0.99")
                a-entity#portal1(position="0 7 -18" size="16 auto")
                    a-plane.animate(scale="1.1 1.1 1" width="0" height="0" shader="flat" color="#fff")
                    a-image.animate(position="0 0 1" color="red" width="0" height="0" src="#tex-photo-2" opacity="0")
                    a-sound(src="#audio-sfx-3" volume="10")

            a-entity.pivot(rotation="0 -20 0")
                a-image#img2(position="-100 7 -190" height="20" image-init="" src="#tex-photo-3" opacity="0")
                    a-sound(src="#audio-sfx-2" volume="20")
                a-image#img3(position="50 7 -250" height="20" image-init="" src="#tex-photo-4" opacity="0")
                    a-sound(src="#audio-sfx-3" volume="20")

            a-entity.pivot(rotation="0 -78 0")
                a-image#img4(position="0 7 -100" height="20" image-init="" src="#tex-photo-5" opacity="0")
                    a-sound(src="#audio-sfx-2" volume="20")

            a-entity.pivot(rotation="0 -160 0")
                a-entity#portal2(position="0 35 -150" size="120 auto")
                    a-plane.animate(scale="1.02 1.02 1" width="0" height="0" shader="flat" color="#fff")
                    a-image.animate(position="0 0 1" width="0" height="0" src="#tex-photo-6" opacity="0")
                    rect-light.animate(width="0" height="0" distance="10")
                    a-sound(src="#audio-sfx-3" volume="20")

            a-entity.pivot(rotation="0 -220 0")
                a-entity(position="0 2 -15")
                    a-image#img5(width="20" image-init="" src="#tex-photo-7" opacity="0")
                        a-sound(src="#audio-sfx-2" volume="7")
                        a-sound(src="#audio-sfx-4" volume="20")
                        
                    a-image#img6(position="-0.5 5.5 1" width="9" image-init="" src="#tex-photo-8" opacity="0")
                        a-sound(src="#audio-sfx-3" volume="7")

    a-entity.sky_weather.particle-snow(position="0 0 0" particle-system="preset: snow; particleCount: 1000; velocityValue: 1 4 1;")

block ui
    div ololo
