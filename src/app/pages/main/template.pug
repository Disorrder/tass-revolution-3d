extends ../../../index.pug

mixin house(color)
    a-entity.house&attributes(attributes)
        a-box(position="0 0.5 0")
        a-cylinder(position="0 1.14 0" rotation="-90 0 0" scale="1.2 1.2 0.7" radius="0.8" segments-radial="3")

block scene
    a-assets
        //- img#skyTexture(crossorigin src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg")
        //- img#skyTexture(crossorigin src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg")
        img#groundTexture(crossorigin src="https://cdn.aframe.io/a-painter/images/floor.jpg")

        img#tex-bg-forest(src="/assets/textures/forest3.png")
        img#tex-bg-piter(src="/assets/textures/piter2.png")
        img#tex-photo-1(src="/assets/photos/scene1/portal1.png")
        img#tex-photo-2(src="/assets/photos/scene1/portal2.png")
        img#tex-photo-3(src="/assets/photos/scene1/Nickolay_black.png")
        img#tex-photo-4(src="/assets/photos/scene1/hleb.png")
        img#tex-photo-5(src="/assets/photos/scene1/red dawn.png")
        img#tex-photo-6(src="/assets/photos/scene1/petrograd.png")

        img#tex-text-1(src="/assets/photos/scene1/text1.png")
        img#tex-text-2(src="/assets/photos/scene1/text2.png")
        img#tex-text-3(src="/assets/photos/scene1/text3.png")
        img#tex-text-4(src="/assets/photos/scene1/text4.png")
        img#tex-text-5(src="/assets/photos/scene1/text5.png")
        img#tex-text-6(src="/assets/photos/scene1/text6.png")
        img#tex-text-7(src="/assets/photos/scene1/text7.png")
        img#tex-text-8(src="/assets/photos/scene1/text8.png")
        img#tex-text-9(src="/assets/photos/scene1/text9.png")
        img#tex-text-10(src="/assets/photos/scene1/text10.png")
        img#tex-text-11(src="/assets/photos/scene1/text11.png")
        img#tex-text-12(src="/assets/photos/scene1/text12.png")
        img#tex-text-13(src="/assets/photos/scene1/text13.png")
        img#tex-text-14(src="/assets/photos/scene1/text14.png")
        img#tex-text-15(src="/assets/photos/scene1/text15.png")
        img#tex-text-16(src="/assets/photos/scene1/winter.png")
        img#tex-text-17(src="/assets/photos/scene1/Russia.png")

        img#tex-ui-tip-1(src="/assets/photos/scene1/tip1.png")

        img#tex-particle-1(src="/assets/textures/explosion_map.png")


        audio#audio-bg-1(src="/assets/audio/scene1/background1.wav")
        audio#audio-pl(src="/assets/audio/scene1/platform_turning.mp3")
        audio#audio-click(src="/assets/audio/scene1/trigger_on.wav")
        audio#audio-text1(src="/assets/audio/scene1/text1.mp3")
        audio#audio-text2(src="/assets/audio/scene1/text2.wav")
        audio#audio-trigger2(src="/assets/audio/scene1/2_train_horn.mp3")
        audio#audio-text5(src="/assets/audio/scene1/text5.wav")
        audio#audio-text6(src="/assets/audio/scene1/text6.wav")
        audio#audio-text7(src="/assets/audio/scene1/text7.wav")
        audio#audio-text9(src="/assets/audio/scene1/trigger_off.wav")
        audio#audio-text10(src="/assets/audio/scene1/trigger_on.wav")

        audio#audio-sfx-11(src="/assets/audio/scene1/1_train_sound.wav")
        audio#audio-sfx-1(src="/assets/audio/scene1/1_train_back.mp3")
        audio#audio-sfx-2(src="/assets/audio/scene1/img_appear-1.wav")
        audio#audio-sfx-3(src="/assets/audio/scene1/img_appear-2.wav")
        audio#audio-sfx-4(src="/assets/audio/scene1/2_train_back.mp3")
        audio#audio-sfx-5(src="/assets/audio/scene1/nikolay_deleted.wav")

        //- mixins
        a-mixin#debug(material="visible: true; wireframe: true; color: red; shader: flat; opacity: 0.4")
        a-mixin#debug-ray(geometry="primitive: box; width: 0.1; depth: 2000;" material="shader: flat; color: yellow; opacity: 0.5")

        a-mixin#halfSphere(geometry="primitive: sphere; radius: 15; thetaLength: 90;")
        a-mixin#sphere(geometry="primitive: sphere; radius: 15;")

        a-mixin#trigger(material="visible: false;" trigger="")
        a-mixin#trigger-particles(_particle-system="preset: snow; particleCount: 100; maxAge: 2; opacity: 1; type: 3; size: 1; color: red,orange; positionSpread: 7 0 7; velocityValue: 0 -2 0; velocitySpread: 2 1 0;")

        a-mixin#black(material="shader: flat; color: #000;")
        a-mixin#grey(material="color: #aaa; roughness: 1;")


    a-sky(color="#000")

    a-light.sky_light(type="ambient" color="#fff" intensity="0")
    a-light.sky_light(type="point" position="0 4 0" color="#fff" intensity="0")

    //- scene fragments
    a-entity#world
        a-entity#backlight(position="0 0 0")
            a-path#bg-fire-path(position="0 100 0" line-geometry="" visible="false")
                a-entity.a-path-point(position="-360 0 -1050" geometry="primitive: box;")
                a-entity.a-path-point(position="-132 0 -1064" geometry="primitive: box;")
                a-entity.a-path-point(position="603 0 -946" geometry="primitive: box;")
                a-entity.a-path-point(position="1128 0 -45" geometry="primitive: box;")
                a-entity.a-path-point(position="892 0 650" geometry="primitive: box;")

            a-entity#pf(position="0 5 -5" particle-fire-2="path: #bg-fire-path;")
            //- a-entity#pf1(position="0 7 -5" particle-fire-2="path: #bg-fire-path;")
            //- a-entity#pf2(position="0 9 -5" particle-fire-2="path: #bg-fire-path;")
            //- a-entity#pf3(position="0 11 -5" particle-fire-2="path: #bg-fire-path;")
            //- a-entity#pf4(position="0 13 -5" particle-fire-2="path: #bg-fire-path;")
            a-box(position="0 4 -5")

            //- a-entity.pivot(rotation="0 0 0")
                a-entity
                    a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 50; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.2; size: 1000,500,1; color: red,orange,black; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")

            //- a-entity.pivot(rotation="0 -45 0")
                a-entity
                    a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 150; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.2; size: 1000,500,1; color: red,orange,black; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
                    //- a-entity.particle-fire.big(position="0 0.11 -1080" particle-system="particleCount: 5; maxAge: 1.5; positionSpread: 1500 50 1; randomize: true; opacity: 0.3; size: 5000; color: red,black; accelerationValue: null; accelerationSpread: null; velocityValue: null; velocitySpread: null; texture: #tex-particle-1;")
                    //- a-entity.particle-fire.small(position="-350 0.11 -1010" particle-system="particleCount: 30; maxAge: 0.5; positionSpread: 1100 50 1; randomize: true; opacity: 0.1; size: 1500; color: orange; accelerationValue: null; accelerationSpread: null; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")

            //- a-entity.pivot(rotation="0 -90 0")
                a-entity
                    //- a-entity.particle-fire.smoke(position="0 0.11 -1050" particle-system="particleCount: 80; maxAge: 5; positionSpread: 1500 50 1; randomize: true; opacity: 0.1; size: 1000; color: red,orange; accelerationValue: null; accelerationSpread: 0 20 20; velocityValue: 200 100 0; velocitySpread: null; texture: #tex-particle-1;")
                    a-entity.particle-fire.small(position="200 -10.11 -1010" particle-system="particleCount: 10; maxAge: 8; positionSpread: 1100 50 1; randomize: true; opacity: 0.8; size: 1500,1,1,1; color: orange,black,black,black; accelerationValue: null; accelerationSpread: null; velocityValue: 200 50 0; velocitySpread: null; texture: #tex-particle-1;")

            //- Horizon textures
            a-cylinder.background(position="0 40 0" geometry="height: 270; radius: 1200; segmentsHeight: 1; thetaStart: 55; thetaLength: 145; openEnded: true;" src="#tex-bg-forest" repeat="2.5 0.9" shader="flat" transparent="true" side="back" color="#000")
            a-cylinder.background(position="0 -70 0" geometry="height: 100; radius: 1200; segmentsHeight: 1; thetaStart: 55; thetaLength: 145; openEnded: true;" _shader="flat" color="#010" side="back")
            //- Horizon Piter
            a-entity.pivot(rotation="0 -230 0")
                //- a-image#img12(position="0 230 -1200" width="1000" image-init="" src="#tex-photo-2" _opacity="0")
                a-image#img12(position="0 73 -1200" width="1000" image-init="" src="#tex-text-12" opacity="0")
                a-image#img121(position="0 500 -1100" width="1000" image-init="" src="#tex-photo-6" opacity="0" color="#fff")
            a-cylinder.background(position="0 50 0" geometry="height: 200; radius: 1000; segmentsHeight: 1; thetaStart: 288; thetaLength: 45; openEnded: true;" src="#tex-bg-piter" repeat="1 0.9" shader="flat" transparent="true" side="back" color="#000")
            //- a-cylinder.background(position="0 50 0" geometry="height: 200; radius: 1100; segmentsHeight: 1; thetaStart: 288; thetaLength: 45; openEnded: true;" _src="#tex-bg-piter" _repeat="1 0.9" shader="flat" _transparent="true" side="back" color="#532")


        a-entity#group1(rotation="0 -40 0" sound="src: #audio-pl; volume: 90; loop: false; on: run")
            a-light(position="0 5 0" type="point" distance="9" intensity="1")
            a-box.platform(position="0 2 0" rotation="0 0 0" width="30" height="0.3" depth="5" src="/assets/textures/wooden_floor.jpg" repeat="1 1" _color="#ccc" roughness="1")
            a-entity#trigger0(position="0 2 0")
                a-entity(mixin="sphere trigger" geometry="radius: 0.7;" material="opacity: 0.1;")
                //- a-entity(mixin="trigger-particles" _particle-system="size: 10; maxAge: 4; positionSpread: 25 0 25;")


        a-entity#group3(rotation="0 -20 0")
            a-entity(position="0 0 -200")
                //- a-entity#trigger1(position="-474 3 0" scale="3 3 3")
                //-     a-entity(mixin="sphere trigger")
                //-     a-entity(mixin="trigger-particles" particle-system="size: 10; maxAge: 4; positionSpread: 25 0 25;")

                a-entity.railway
                    a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    //- a-entity#flag_t1(position="-400 0 0" scale="1 10 1" mixin="halfSphere debug")
                    //- a-entity#flag_t2(position="450 0 0" scale="1 10 1" mixin="halfSphere debug")
                    a-entity#train1(position="-400 0 0" rotation="0 180 0" scale="2.2 2.2 2.2"
                        __material="shader: flat; color: #000;" __common-material
                        gen-train="wagonMap: head,passanger,passanger,passanger,generic,platform,platform,platform,tanker,tanker,tanker,tanker,passanger,passanger,passanger"
                        sound="src: #audio-sfx-1; volume: 90; loop: false; on: run;"
                    )
                        a-animation(begin="run" dur="11000" attribute="position" to="450 0 0" easing="linear")

                    a-box(position="-500 4 0" width="300" height="9" depth="20" mixin="black" color="#000")
                    a-box(position="290 4 0" width="300" height="9" depth="20" mixin="black" color="#000")

        a-entity#group4(rotation="0 -160 0")
            a-entity(position="-50 0 -70")
                a-entity.railway
                    a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    a-entity#train2(position="-200 0 0" rotation="0 180 0" scale="2.2 2.2 2.2"
                        __material="shader: flat; color: #000;" __common-material
                        gen-train="wagonMap: head,passanger,passanger,passanger,generic,platform,platform,platform,tanker,tanker,tanker,tanker,passanger,passanger,passanger"
                        sound="src: #audio-sfx-4; volume: 90; loop: false; on: run;"
                    )
                        a-animation(begin="run" dur="10000" attribute="position" to="320 0 0" easing="ease-out-sine")

                    a-box(position="-300 4 0" width="300" height="9" depth="20" mixin="black" color="#000")

                a-entity.houses
                    +house()(position="-40 0 -20" scale="5 5 5")
                    +house()(position="10 0 -40" scale="5 5 5")
                    +house()(position="25 0 -20" scale="5 5 5")

        a-entity#group5(rotation="0 -40 0")
            a-entity(position="-200 0 10")
                a-entity.railway
                    //- a-box(position="0 -0.4 0" width="2000" height="1" depth="100" mixin="black")
                    a-entity#train3(position="-200 0 0" rotation="0 180 0" scale="4 4 4"
                        gen-train="wagonMap: head,passanger,passanger,generic,platform,platform,tanker,tanker,passanger,passanger,passanger"
                    )
                        a-animation(begin="run" _delay="2000" dur="10000" attribute="position" to="715 0 0" easing="ease-out-sine")

                    a-box(position="-300 4 0" width="300" height="9" depth="20" mixin="black" color="#000")

        a-entity#group6(rotation="0 -220 0")
            a-entity(position="0 0 -400")
                //- a-entity#trigger2(position="0 3 0" scale="10 5 10")
                    a-entity(mixin="sphere trigger debug" geometry="radius: 15;")
                    //- a-entity(mixin="trigger-particles" particle-system="size: 10; particleCount: 200; maxAge: 4; positionSpread: 25 0 25;")

        a-entity.radial#images
            a-entity.pivot(rotation="0 50 0")
                a-entity#trigger1(position="0 3 -100" _scale="1 1 1"
                sound="src: #audio-click; volume: 50; on: click;")
                    a-entity(mixin="sphere trigger")
                    a-entity(mixin="trigger-particles" _particle-system="size: 3; maxAge: 4; positionSpread: 25 0 25;")

                    a-image(position="0 20 0" height="9" image-init="" src="#tex-text-16")
                    a-image.img-1(position="0 -1 0" height="7" image-init="" src="#tex-text-17" opacity="0")

                //- a-image#img1(position="0 12 -16" width="12" image-init="" src="#tex-photo-1" opacity="0")
                a-entity#portal1(position="0 7 -18" size="12 auto")
                    a-plane.animate(scale="1.1 1.1 1" width="0" height="0" shader="flat" color="#fff")
                    a-image.animate(position="0 0 1" color="red" width="0" height="0" src="#tex-photo-1" opacity="0")
                    a-sound(src="#audio-sfx-3" volume="10")


            a-entity.pivot(rotation="0 -20 0")
                a-image#img2(position="-100 7 -190" height="20" image-init="" src="#tex-text-1" opacity="0")
                    a-sound(src="#audio-text1" volume="70")
                a-image#img3(position="50 7 -250" height="20" image-init="" src="#tex-text-2" opacity="0")
                    a-sound(src="#audio-text2" volume="80")

            a-entity.pivot(rotation="0 -78 0")
                a-image#img4(position="0 7 -100" height="12" image-init="" src="#tex-text-3" opacity="0")
                    a-sound(src="#audio-sfx-2" volume="20")

                a-entity#trigger2(position="0 3 -100" _scale="1 1 1" visible="false" trigger="false"
                sound="src: #audio-trigger2; volume: 50; on: click;")
                    a-entity(mixin="sphere trigger")
                    a-entity(mixin="trigger-particles" _particle-system="size: 3; maxAge: 4; positionSpread: 25 0 25;")
                    a-image.img-1(position="0 4 0" height="12" image-init="" src="#tex-text-4" opacity="0")

            a-entity.pivot(rotation="0 -160 0")
                a-image#img5(position="-54.4 7 -110" look-at="#player" height="12" image-init="" src="#tex-text-5" opacity="0")
                    a-sound(src="#audio-text5" volume="40")
                a-image#img6(position="0 7 -110" look-at="#player" height="11" image-init="" src="#tex-text-6" opacity="0")
                    a-sound(src="#audio-text6" volume="40")
                a-image#img7(position="47 4 -66" height="10" image-init="" src="#tex-text-7" opacity="0")
                    a-sound(src="#audio-text7" volume="40")
                a-image#img8(position="270 25 -100" rotation="0 -90 0" height="50" image-init="" src="#tex-text-8" opacity="0")
                    a-sound(src="#audio-text2" volume="80")
                a-image#img9(position="200 43 -100" look-at="#player" height="12" image-init="" src="#tex-text-9" opacity="0")
                    a-sound(src="#audio-text9" volume="70")


            a-entity.pivot(rotation="0 -230 0")
                a-image#img10(position="0 25 -100" height="12" image-init="" src="#tex-text-9" opacity="0")
                  a-sound(src="#audio-text9" volume="20")
                a-image#img11(position="0 5 -100" height="12" image-init="" src="#tex-text-10" opacity="0")
                  a-sound(src="#audio-text9" volume="20")
                a-entity#trigger3(position="0 3 -100" _scale="1 1 1" visible="false" active="false"
                sound="src: #audio-click; volume: 50; on: click;")
                    a-entity(mixin="sphere trigger")
                    a-entity(mixin="trigger-particles" _particle-system="size: 3; maxAge: 4; positionSpread: 25 0 25;")

                //- a-image#img121(position="0 73 -900" width="800" image-init="" src="#tex-text-14" opacity="0")

                //- a-entity#portal2(position="0 35 -1300" size="1000 auto")
                    a-plane.animate(scale="1.02 1.02 1" width="0" height="0" shader="flat" color="#fff")
                    a-image.animate(position="0 0 1" width="0" height="0" src="#tex-photo-6" opacity="0")
                    //- rect-light.animate(width="0" height="0" distance="10")
                    //- a-sound(src="#audio-sfx-3" volume="20")


            a-entity.pivot(rotation="0 -220 0")
                a-entity(position="0 5.5 -15")
                    //- a-image#img13(position="0 5 -100" height="12" image-init="" src="#tex-photo-3" _opacity="0")
                    //- a-image#img13(position="0 5 -100" height="12" image-init="" src="#tex-photo-3" _opacity="0")

                    a-image#img13(width="20" image-init="" src="#tex-photo-3" _transparent="true" opacity="0" color="#fff")
                        a-sound(src="#audio-sfx-2" volume="7")
                        a-sound(src="#audio-sfx-4" volume="20")

                    a-image#img14(position="0 1.8 1" width="9" image-init="" src="#tex-photo-4" opacity="0")
                        a-sound(src="#audio-sfx-3" volume="7")




    a-entity.sky_weather.particle-snow(position="0 0 0" _particle-system="preset: snow; particleCount: 1000; velocityValue: 1 4 1;")

    //- global objects
    a-entity#player(position="0 2 0" rotation="0 20 0")
        a-sound#bg_sound(src="#audio-bg-1" volume="1" autoplay="true" loop="true")
        a-camera(wasd-controls="acceleration: 650;" fov="75")
            a-entity(position="0 0 -2")
                a-cursor(material="color: #eee; opacity: 0.8" fuse="true" fuse-timeout="1500" raycaster="objects: .interactive" cursor-events)
                    a-animation(begin="fusing" end="mouseleave" attribute="scale" to="2 2 2" dur="1500" easing="ease-in")
                    a-animation(begin="fusing" end="mouseleave" attribute="geometry.thetaLength" from="360" to="0" dur="1500" easing="ease-in")

                    a-animation(begin="mouseleave" attribute="scale" to="1 1 1" dur="100" easing="ease")
                    a-animation(begin="mouseleave" attribute="geometry.thetaLength" to="360" dur="500" easing="ease")

                    a-animation(begin="click" attribute="scale" from="0 0 0" to="1 1 1" _delay="100" dur="300" easing="ease")
                    a-animation(begin="click" attribute="geometry.thetaLength" to="360" dur="100" easing="ease")

            a-entity#sound
            //- fov is 75, gui z is -0.7, when 1 is 100% width and about 95% height
            a-entity#gui(position="0 0 -0.07" scale="0.1 0.1 0.1")
                //- a-image#tip(position="0 0.3 0" width="0.5" src="" npot="true" image-init="" opacity="0" visible="false")

block ui
    div ololo
